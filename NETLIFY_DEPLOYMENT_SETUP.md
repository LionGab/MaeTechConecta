# Netlify Deployment Setup - Nossa Maternidade

## Project Information

- **Project Name:** Nossa Maternidade
- **Domain:** www.nossamaternidade.com.br
- **Netlify Admin URL:** https://app.netlify.com/projects/nossamaternidade
- **Project ID:** 82dc2ce0-4b4b-4011-b703-06d51307f0f6
- **Deploy Type:** GitHub Auto-Deploy

## Project Structure

This is a monorepo built with:
- **Package Manager:** pnpm (v9.12.0)
- **Build System:** Turbo
- **Mobile Framework:** Expo (v52.0.0)
- **Web Support:** Expo Web (React Native Web)

### Directory Structure
```
LionNath/
├── apps/
│   └── mobile/              # Main Expo app (supports web, iOS, Android)
├── packages/
│   ├── shared/              # Shared utilities
│   └── shared-types/        # Shared TypeScript types
└── netlify.toml             # Netlify configuration
```

## Netlify Configuration

### Build Settings (netlify.toml)

The `netlify.toml` file has been created with the following configuration:

```toml
[build]
  base = "apps/mobile"
  command = "pnpm install && pnpm run build:web"
  publish = "dist"
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- apps/mobile packages/"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--prefer-offline --no-audit"
  HUSKY = "0"
```

**Key Points:**
- Build starts from `apps/mobile` directory
- Uses Expo's web export: `pnpm run build:web`
- Publishes the `dist` folder generated by Expo
- Only rebuilds if changes detected in `apps/mobile` or `packages/`
- Skips Husky hooks in CI environment

## Environment Variables

### Required Variables

You need to configure these environment variables in Netlify Dashboard:

1. **Supabase (REQUIRED)**
   ```
   EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   EXPO_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   EXPO_PUBLIC_SUPABASE_FUNCTIONS_URL=https://your-project.supabase.co/functions/v1
   ```

2. **AI APIs (RECOMMENDED)**
   ```
   EXPO_PUBLIC_GEMINI_API_KEY=your_gemini_api_key
   EXPO_PUBLIC_CLAUDE_API_KEY=your_claude_api_key (optional fallback)
   EXPO_PUBLIC_OPENAI_API_KEY=your_openai_api_key (optional)
   ```

3. **Payments (OPTIONAL)**
   ```
   EXPO_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_key
   ```

4. **Other Services (OPTIONAL)**
   ```
   EXPO_PUBLIC_ONESIGNAL_APP_ID=your_onesignal_id
   EXPO_PUBLIC_PERPLEXITY_API_KEY=your_perplexity_key
   EXPO_PUBLIC_ELEVENLABS_API_KEY=your_elevenlabs_key
   EXPO_PUBLIC_HEYGEN_API_KEY=your_heygen_key
   ```

### How to Configure Environment Variables

#### Option 1: Using Supabase Extension (Recommended)

1. Go to https://app.netlify.com/extensions
2. Search for "Supabase" and install the extension
3. Navigate to your site: https://app.netlify.com/sites/nossamaternidade
4. Go to **Site Configuration** → **Supabase** (sidebar)
5. Click **Connect** and link your Supabase account
6. Select your Supabase project
7. Click **Save**

Then add Expo-specific variables:

1. Go to **Site settings** → **Environment variables**
2. Add:
   ```
   EXPO_PUBLIC_SUPABASE_URL = ${SUPABASE_DATABASE_URL}
   EXPO_PUBLIC_SUPABASE_ANON_KEY = ${SUPABASE_ANON_KEY}
   ```

#### Option 2: Manual Configuration

1. Go to https://app.netlify.com/sites/nossamaternidade/settings
2. Navigate to **Environment variables**
3. Click **Add a variable** or **Import from a .env file**
4. Add each variable from the list above
5. Make sure to select the correct scopes (Production, Deploy Previews, Branch Deploys)

### Getting API Keys

- **Supabase:** https://app.supabase.com/project/your-project/settings/api
- **Gemini:** https://makersuite.google.com/app/apikey
- **Claude:** https://console.anthropic.com/
- **OpenAI:** https://platform.openai.com/api-keys
- **Stripe:** https://dashboard.stripe.com/apikeys

## Deployment Process

### Automatic Deployment

The site is configured for automatic deployment from GitHub:

1. Push changes to the `main` branch
2. Netlify automatically detects the changes
3. Builds the web version using Expo
4. Deploys to www.nossamaternidade.com.br

### Manual Deployment

Using Netlify CLI:

```bash
# From project root
cd C:\Users\Usuario\Documents\LionNath

# Deploy to production
netlify deploy --prod

# Deploy preview
netlify deploy
```

### Build Locally (Test)

To test the build locally before deploying:

```bash
# Install dependencies
pnpm install

# Build web version
cd apps/mobile
pnpm run build:web

# The output will be in apps/mobile/dist/
```

## Domain Configuration

The domain **www.nossamaternidade.com.br** is already linked to the Netlify site.

To verify or update domain settings:

1. Go to https://app.netlify.com/sites/nossamaternidade/settings/domain
2. Check DNS configuration
3. Ensure SSL/TLS certificate is active

## Troubleshooting

### Build Fails

1. **Check build logs:**
   - Go to https://app.netlify.com/sites/nossamaternidade/deploys
   - Click on the failed deploy
   - Review the build log for errors

2. **Common issues:**
   - Missing environment variables
   - Node/pnpm version mismatch
   - Build command errors
   - Dependency installation failures

### Environment Variables Not Working

1. Ensure variables have the `EXPO_PUBLIC_` prefix
2. Verify no extra spaces in variable names or values
3. Check that variables are set for the correct deploy context (Production/Preview)
4. Trigger a new deploy after adding variables

### Web Build Issues

1. Test locally first:
   ```bash
   cd apps/mobile
   pnpm run dev:web
   ```

2. Check Expo web compatibility:
   - Some React Native libraries don't work on web
   - Review console for platform-specific errors

## Security Headers

The configuration includes security headers:

- `X-Frame-Options: DENY` - Prevents clickjacking
- `X-Content-Type-Options: nosniff` - Prevents MIME sniffing
- `X-XSS-Protection: 1; mode=block` - XSS protection
- `Referrer-Policy: strict-origin-when-cross-origin` - Referrer control

## Caching Strategy

- **JavaScript/CSS:** 1 year cache (immutable)
- **Assets:** 1 year cache (immutable)
- **index.html:** No cache (always fresh)

## SPA Routing

All routes redirect to `index.html` for client-side routing:

```toml
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

## Next Steps

1. **Configure Environment Variables**
   - Add all required environment variables in Netlify Dashboard
   - Test with a manual deploy

2. **Test Build**
   - Push a small change to trigger a build
   - Monitor the build logs
   - Check the deployed site

3. **Verify Features**
   - Test authentication (Supabase)
   - Test AI chat functionality (Gemini/Claude)
   - Test all main features

4. **Monitor Performance**
   - Use Netlify Analytics
   - Check Core Web Vitals
   - Monitor error rates

5. **Setup Custom Domain (if not done)**
   - Ensure DNS is correctly configured
   - Verify SSL certificate is active

## Support & Resources

- **Netlify Documentation:** https://docs.netlify.com
- **Expo Web Documentation:** https://docs.expo.dev/workflow/web/
- **Project Admin Panel:** https://app.netlify.com/sites/nossamaternidade

## Status

- ✅ Netlify CLI installed and authenticated
- ✅ Project linked to Netlify (nossamaternidade)
- ✅ netlify.toml configuration created
- ✅ Domain linked (www.nossamaternidade.com.br)
- ⚠️ Environment variables need to be configured
- ⚠️ First deployment pending

---

**Last Updated:** 2025-11-06
**Configured By:** Claude Code AI Assistant
