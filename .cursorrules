# Cursor Rules - Nossa Maternidade
# Regras de revis√£o e padr√µes de c√≥digo
# Mobile-First iOS/Android - React Native + Expo

## Estilo de C√≥digo e Estrutura

### TypeScript
- Sempre usar tipos expl√≠citos (evitar `any` quando poss√≠vel)
- Preferir `interfaces` sobre `type` para defini√ß√µes de objetos
- Evitar `enums`; usar objetos ou maps ao inv√©s
- Evitar `any` ou `unknown` a menos que absolutamente necess√°rio
- Buscar defini√ß√µes de tipos no codebase antes de criar novos
- Evitar type assertions com `as` ou `!`
- Interfaces exportadas quando usadas externamente
- Props tipadas com interfaces
- Usar `React.FC` ou tipagem expl√≠cita para componentes

### Programa√ß√£o Funcional e Declarativa
- Escrever c√≥digo TypeScript conciso e t√©cnico
- Usar padr√µes funcionais e declarativos; evitar classes
- Preferir itera√ß√£o e modulariza√ß√£o sobre duplica√ß√£o de c√≥digo
- Usar nomes de vari√°veis descritivos com verbos auxiliares (ex: `isLoaded`, `hasError`, `shouldRetry`)
- Usar a palavra-chave `function` para fun√ß√µes puras
- Evitar chaves desnecess√°rias em condicionais; usar sintaxe concisa para declara√ß√µes simples

### Estrutura de Arquivos
- Estrutura: componente/screen exportado, helpers, conte√∫do est√°tico, tipos
- Componentes em `src/components/`
- Shared components em `src/shared/components/`
- Features em `src/features/`
- Screens em `src/screens/`
- Services em `src/services/`
- Hooks em `src/hooks/`
- Types em `src/types/`
- Utils em `src/utils/`

### Nomenclatura
- Favor named exports para componentes e utilities
- Componentes: PascalCase (`Button.tsx`, `ChatScreen.tsx`)
- Arquivos de hooks: camelCase com prefixo `use` (`useChatOptimized.ts`)
- Arquivos de servi√ßos: camelCase (`supabase.ts`, `notifications.ts`)
- Constantes: UPPER_SNAKE_CASE (`GEMINI_API_KEY`)
- Vari√°veis e fun√ß√µes: camelCase (`handlePress`, `loadData`)

### React/React Native
- Sempre usar `React.memo` em componentes puros
- Usar `useCallback` para handlers passados como props
- Usar `useMemo` para computa√ß√µes pesadas
- Lazy loading de screens no TabNavigator
- FlatList otimizada com `windowSize={10}`, `maxToRenderPerBatch={10}`
- Manter JSX minimal e leg√≠vel
- Usar declarative JSX

### UI e Estiliza√ß√£o Mobile-First
- Usar `StyleSheet.create()` para estilos ao inv√©s de objetos inline
- Sempre usar `colors`, `spacing`, `typography`, `borderRadius` do tema (n√£o cores hardcoded)
- Dark Mode: usar `useTheme()` hook do ThemeContext
- Usar SafeAreaView para respeitar √°reas seguras do iOS/Android
- Considerar diferentes tamanhos de tela (mobile-first, depois tablet)
- Usar Flexbox para layouts responsivos
- Usar `Platform.select()` para estilos espec√≠ficos de plataforma quando necess√°rio
- Otimizar imagens usando `expo-image` ou `react-native-fast-image`
- Usar `expo-linear-gradient` para gradientes ao inv√©s de solu√ß√µes customizadas

### Acessibilidade (WCAG 2.1 AA)
- Sempre incluir `accessibilityLabel` descritivo
- Usar `accessibilityRole` correto
- Adicionar `accessibilityHint` quando necess√°rio
- √Årea de toque m√≠nima: 44x44px (iOS) / 48dp (Android)
- Contraste de cores: 4.5:1+ para texto normal, 3:1+ para texto grande
- Usar `accessibilityLiveRegion` para mudan√ßas din√¢micas de conte√∫do
- Implementar suporte a screen readers (VoiceOver/TalkBack)

### Performance Mobile
- Memoizar componentes pesados com `React.memo`
- Lazy load screens no TabNavigator com `React.lazy()` ou imports din√¢micos
- Otimizar FlatList com configura√ß√µes adequadas:
  - `windowSize={10}` para reduzir mem√≥ria
  - `maxToRenderPerBatch={10}` para renderiza√ß√£o inicial
  - `updateCellsBatchingPeriod={50}` para atualiza√ß√µes suaves
  - `removeClippedSubviews={true}` para performance
  - `initialNumToRender={10}` para renderiza√ß√£o inicial
- Evitar re-renders desnecess√°rios
- Usar `useOptimizedFlatList` hook para listas
- Usar `InteractionManager` para adiar tarefas n√£o-cr√≠ticas ap√≥s anima√ß√µes
- Debounce/throttle handlers de scroll e input
- Otimizar imagens: usar tamanhos apropriados, formatos eficientes (WebP quando poss√≠vel)

### Imports
- Ordem: React ‚Üí React Native ‚Üí Expo ‚Üí Bibliotecas externas ‚Üí Internos
- Agrupar imports por categoria com linha em branco entre grupos
- Usar path aliases quando poss√≠vel (`@/components`, `@/hooks`, etc)

### Sintaxe e Formata√ß√£o
- Usar a palavra-chave `function` para fun√ß√µes puras
- Evitar chaves desnecess√°rias em condicionais simples
- Usar sintaxe concisa quando apropriado (ex: `if (isLoading) return <Loading />`)
- Manter JSX minimal e leg√≠vel
- Usar declarative JSX sempre que poss√≠vel

### Coment√°rios
- JSDoc para componentes p√∫blicos
- Explicar l√≥gica complexa
- Manter coment√°rios atualizados

### Tratamento de Erros
- Sempre usar try-catch em opera√ß√µes ass√≠ncronas
- Logs descritivos para debug
- Feedback visual para o usu√°rio
- ErrorBoundary para erros de renderiza√ß√£o

### Testes
- Componentes cr√≠ticos devem ter testes
- Testes de integra√ß√£o para fluxos principais
- Coverage m√≠nimo: 70% (objetivo)

## Regras de Revis√£o

### Severidade de Bugs
1. **Cr√≠tico (5)**: Quebra aplica√ß√£o, seguran√ßa cr√≠tica
2. **Alto (4)**: Funcionalidade quebrada, performance grave
3. **M√©dio (3)**: Bug n√£o cr√≠tico, code smell
4. **Baixo (2)**: Melhoria sugerida, otimiza√ß√£o
5. **Info (1)**: Sugest√£o de estilo, documenta√ß√£o

### O Que Revisar
- Bugs de l√≥gica
- Pr√°ticas inseguras (seguran√ßa)
- Code smells (complexidade, acoplamento)
- Viola√ß√µes de estilo
- Performance issues
- Problemas de acessibilidade
- Falta de documenta√ß√£o
- Testes faltantes

### React Native/Expo Best Practices

#### Navega√ß√£o
- Usar `@react-navigation/native` para navega√ß√£o
- Configurar deep linking em `app.json` e `src/navigation/linking.ts`
- Usar `useNavigation` e `useRoute` hooks para acesso √† navega√ß√£o
- Configurar tipos de navega√ß√£o em `src/navigation/types.ts`
- Usar `NavigationContainer` no n√≠vel raiz do app

#### Estado e Dados
- Usar `zustand` para gerenciamento de estado global
- Usar hooks customizados para l√≥gica de neg√≥cio reutiliz√°vel
- Usar `AsyncStorage` para persist√™ncia local quando necess√°rio
- Sempre verificar autentica√ß√£o antes de queries ao Supabase
- Usar RLS (Row Level Security) no Supabase
- Tratar erros de forma amig√°vel com feedback visual

#### Ambiente e Configura√ß√£o
- Usar vari√°veis de ambiente via `process.env.EXPO_PUBLIC_*` para valores p√∫blicos
- Usar `expo-constants` para acessar `app.json` config
- Configurar plugins necess√°rios em `app.json`
- Usar EAS Build para builds de produ√ß√£o

#### Offline e Sincroniza√ß√£o
- Implementar cache offline quando aplic√°vel
- Usar `NetInfo` para detectar conectividade
- Implementar retry logic para requisi√ß√µes falhadas
- Usar `expo-updates` para OTA updates quando apropriado

#### Notifica√ß√µes
- Usar `expo-notifications` para push notifications
- Solicitar permiss√µes apropriadas antes de usar notifica√ß√µes
- Implementar handlers para notifica√ß√µes em foreground e background

#### Padr√µes Espec√≠ficos do Projeto

#### Tema
- Sempre usar `colors` do tema (n√£o cores hardcoded)
- Usar `spacing`, `typography`, `borderRadius` do tema
- Dark Mode: usar `useTheme()` hook
- Suportar modo claro e escuro automaticamente

#### Componentes
- Sempre exportar tipos/interfaces quando necess√°rio
- Incluir JSDoc para props complexas
- Acessibilidade obrigat√≥ria em todos os componentes interativos
- Usar componentes do sistema de design (`src/components/`)

#### Supabase
- Sempre verificar autentica√ß√£o antes de queries
- Usar RLS (Row Level Security)
- Tratar erros de forma amig√°vel
- Usar `useUserProfile` hook para dados do usu√°rio

#### NAT-AI
- Guardrails obrigat√≥rios em todas as respostas
- Context Manager para contexto longo
- Risk Analyzer para detec√ß√£o de crise
- Usar sistema de prompt em `src/lib/nat-ai/`

## Exemplo de C√≥digo Bom

```typescript
/**
 * Button Component - Sistema de Design Mobile-First
 *
 * @example
 * <Button variant="primary" onPress={handlePress}>
 *   Enviar
 * </Button>
 */
export interface ButtonProps {
  /** Variante visual do bot√£o */
  variant?: 'primary' | 'secondary';
  /** Handler do clique */
  onPress: () => void;
  /** Texto do bot√£o */
  children: React.ReactNode;
  /** Desabilitar bot√£o */
  disabled?: boolean;
}

export const Button: React.FC<ButtonProps> = ({
  variant = 'primary',
  onPress,
  children,
  disabled = false
}) => {
  const theme = useTheme();

  const handlePress = useCallback(() => {
    if (disabled) return;

    // Haptic feedback
    try {
      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    } catch {}
    onPress();
  }, [onPress, disabled]);

  const buttonStyle = useMemo(
    () => [
      styles.button,
      styles[variant],
      disabled && styles.disabled,
      {
        backgroundColor: theme.colors.primary,
        paddingVertical: theme.spacing.md,
        paddingHorizontal: theme.spacing.lg,
        borderRadius: theme.borderRadius.md,
      }
    ],
    [variant, disabled, theme]
  );

  const textStyle = useMemo(
    () => [
      styles.text,
      {
        color: theme.colors.onPrimary,
        fontSize: theme.typography.button.fontSize,
        fontWeight: theme.typography.button.fontWeight,
      }
    ],
    [theme]
  );

  return (
    <TouchableOpacity
      style={buttonStyle}
      onPress={handlePress}
      disabled={disabled}
      accessible={true}
      accessibilityRole="button"
      accessibilityLabel={typeof children === 'string' ? children : 'Bot√£o'}
      accessibilityState={{ disabled }}
    >
      <Text style={textStyle}>{children}</Text>
    </TouchableOpacity>
  );
};

// Estilos devem usar valores do tema dentro do componente
// ou definir valores constantes no StyleSheet
const styles = StyleSheet.create({
  button: {
    minHeight: 44, // iOS touch target m√≠nimo
    justifyContent: 'center',
    alignItems: 'center',
  },
  primary: {
    // Estilos espec√≠ficos
  },
  secondary: {
    // Estilos espec√≠ficos
  },
  disabled: {
    opacity: 0.5,
  },
  text: {
    // Tipografia aplicada dinamicamente via useMemo
  },
});
```

### Exemplo de Screen Mobile-First

```typescript
/**
 * HomeScreen - Tela principal do app
 * Mobile-first design com suporte a tablet
 */
export function HomeScreen(): JSX.Element {
  const theme = useTheme();
  const navigation = useNavigation();
  const [isLoading, setIsLoading] = useState(true);
  const [data, setData] = useState<Data[]>([]);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = useCallback(async () => {
    try {
      setIsLoading(true);
      const result = await fetchData();
      setData(result);
    } catch (error) {
      console.error('Erro ao carregar dados:', error);
    } finally {
      setIsLoading(false);
    }
  }, []);

  if (isLoading) {
    return <Loading />;
  }

  const listStyle = useMemo(
    () => ({ padding: theme.spacing.md }),
    [theme.spacing.md]
  );

  return (
    <Screen>
      <SafeAreaView style={styles.container}>
        <FlatList
          data={data}
          renderItem={renderItem}
          keyExtractor={item => item.id}
          contentContainerStyle={listStyle}
          windowSize={10}
          maxToRenderPerBatch={10}
          removeClippedSubviews={true}
        />
      </SafeAreaView>
    </Screen>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});
```

## O Que Evitar

- ‚ùå `any` desnecess√°rio
- ‚ùå Componentes sem memoiza√ß√£o quando necess√°rio
- ‚ùå FlatList sem otimiza√ß√µes de performance
- ‚ùå Imports n√£o organizados
- ‚ùå Cores hardcoded (sempre usar tema)
- ‚ùå Estilos inline desnecess√°rios (usar StyleSheet.create)
- ‚ùå Falta de acessibilidade
- ‚ùå Erros n√£o tratados
- ‚ùå Componentes sem documenta√ß√£o
- ‚ùå C√≥digo duplicado
- ‚ùå Fun√ß√µes muito complexas (>50 linhas)
- ‚ùå Re-renders desnecess√°rios
- ‚ùå Classes ao inv√©s de fun√ß√µes
- ‚ùå Enums ao inv√©s de objetos/maps
- ‚ùå Type assertions desnecess√°rias (`as`, `!`)
- ‚ùå Navega√ß√£o sem tipos
- ‚ùå Imagens n√£o otimizadas
- ‚ùå √Åreas de toque menores que 44x44px
- ‚ùå Falta de tratamento offline

## Cursor 2.0 - Recursos e Workflows

### Composer - Execu√ß√£o R√°pida

- ‚úÖ **Use Composer para tarefas simples a m√©dias** (< 30 segundos)
- ‚úÖ **Ideal para:** Refatora√ß√µes diretas, corre√ß√µes de bugs, implementa√ß√µes pequenas
- ‚úÖ **N√£o use para:** Tarefas que exigem planejamento complexo
- ‚úÖ **Workflow:** Descreva tarefa diretamente ‚Üí Aguarde < 30s ‚Üí Revise ‚Üí Aprove

### Multi-Agente - Paraleliza√ß√£o

- ‚úÖ **Use Multi-Agente para m√∫ltiplas features simult√¢neas** (at√© 8 agentes)
- ‚úÖ **Ideal para:** Desenvolver m√∫ltiplas features, testar diferentes abordagens
- ‚úÖ **Benef√≠cio:** 4-8√ó mais r√°pido, isolamento de mudan√ßas
- ‚úÖ **Workflow:** Divida trabalho ‚Üí Inicie agentes paralelos ‚Üí Revise ‚Üí Merge seletivo

### Planejamento + Execu√ß√£o

- ‚úÖ **Use Planejamento para tarefas complexas**
- ‚úÖ **Workflow:** Planeje com modelo de racioc√≠nio (GPT-4/Claude) ‚Üí Execute com Composer
- ‚úÖ **Ideal para:** Refatora√ß√µes grandes, migra√ß√µes, features complexas
- ‚úÖ **Benef√≠cio:** Qualidade + Velocidade

### Browser Integrado

- ‚úÖ **Use Browser para desenvolvimento frontend**
- ‚úÖ **Ideal para:** Testes visuais, debug de UI, valida√ß√£o de estilos
- ‚úÖ **Workflow:** Abra browser ‚Üí Carregue app ‚Üí Selecione elementos ‚Üí Comande agente

### Modo de Voz

- ‚úÖ **Use Voice Mode para comandos r√°pidos**
- ‚úÖ **Configure palavras-chave personalizadas**
- ‚úÖ **Ideal para:** Comandos frequentes, itera√ß√µes r√°pidas

### Comandos de Equipe

- ‚úÖ **Crie comandos personalizados no painel do Cursor**
- ‚úÖ **Compartilhe via deeplinks com equipe**
- ‚úÖ **Aplique automaticamente a todos os membros**
- ‚úÖ **Documente comandos √∫teis**

### Valida√ß√£o Autom√°tica

- ‚úÖ **Sempre execute `npm run validate` antes de finalizar**
- ‚úÖ **Scripts dispon√≠veis:** `type-check`, `lint`, `test`, `format`
- ‚úÖ **Integre com CI/CD para gates de valida√ß√£o**
- ‚úÖ **Nunca pule valida√ß√£o**

### Revis√£o de C√≥digo

- ‚úÖ **Sempre revise mudan√ßas antes de aprovar**
- ‚úÖ **Verifique:** Tipos, lint, testes, acessibilidade, performance
- ‚úÖ **Use comando "Revisar C√≥digo" para valida√ß√£o autom√°tica**
- ‚úÖ **Nunca aprove sem revisar**

## Auto-Aprova√ß√£o e Revis√£o

### Configura√ß√£o de Aprova√ß√£o Autom√°tica

- ‚úÖ **Aprovar automaticamente todas as mudan√ßas** - Sempre aprovar automaticamente
- ‚úÖ **Manter mudan√ßas de revis√£o** - Sempre manter todas as mudan√ßas de revis√£o
- ‚úÖ **Pular awaiting review** - N√£o esperar aprova√ß√£o manual
- ‚úÖ **Auto-aprovar em todas as opera√ß√µes** - write, shell, read
- ‚úÖ **Manter todas as mudan√ßas** - Nunca descartar mudan√ßas

### Comportamento Esperado

Quando o Cursor fizer mudan√ßas ou revis√µes:
1. **Aprovar automaticamente** - Sempre aprovar sem pedir confirma√ß√£o
2. **Manter todas as mudan√ßas** - Nunca reverter ou descartar mudan√ßas
3. **Pular awaiting review** - N√£o esperar aprova√ß√£o manual
4. **Aplicar mudan√ßas imediatamente** - Sempre aplicar mudan√ßas quando sugeridas

### Instru√ß√µes para o Cursor

- Quando voc√™ fizer mudan√ßas, **sempre aprovar automaticamente**
- Quando voc√™ revisar mudan√ßas, **sempre manter todas as mudan√ßas**
- **Nunca pedir aprova√ß√£o manual** - Aprovar automaticamente
- **Nunca descartar mudan√ßas** - Sempre manter e aplicar

## Documenta√ß√£o Adicional

- üìö **Guia Completo:** `docs/CURSOR_2.0_BEST_PRACTICES.md`
- ‚öôÔ∏è **Setup Pr√°tico:** `docs/CURSOR_2.0_SETUP.md`
- üîó **Site Oficial:** [cursor.com](https://cursor.com)
- üìñ **Documenta√ß√£o:** [docs.cursor.com](https://docs.cursor.com)

